<!--@layout(/layout/basic/layout.html)-->
<!--@css(/css/module/order/form.css)-->

<!-- iOS에서는 position:fixed 버그가 있음, 적용하는 사이트에 맞게 position:absolute 등을 이용하여 top,left값 조정 필요 -->
<div id="layer" style="display:none;position:fixed;overflow:hidden;z-index:1;-webkit-overflow-scrolling:touch;background-color:#fff;">
<img src="//t1.daumcdn.net/localimg/localimages/07/postcode/320/close.png" id="btnCloseLayer" style="cursor:pointer;position:absolute;right:-3px;top:-3px;z-index:1" onclick="closeDaumPostcode()" alt="닫기 버튼">
</div>

<script src="http://dmaps.daum.net/map_js_init/postcode.v2.js"></script>
<script>
    // 우편번호 찾기 화면을 넣을 element
    var element_layer = document.getElementById('layer');

    function closeDaumPostcode() {
        // iframe을 넣은 element를 안보이게 한다.
        element_layer.style.display = 'none';
    }

    function sample4_execDaumPostcode() {
        new daum.Postcode({
            oncomplete: function(data) {
                // 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분.

                // 각 주소의 노출 규칙에 따라 주소를 조합한다.
                // 내려오는 변수가 값이 없는 경우엔 공백('')값을 가지므로, 이를 참고하여 분기 한다.
                var fullAddr = data.address; // 최종 주소 변수
                var extraAddr = ''; // 조합형 주소 변수

                // 기본 주소가 도로명 타입일때 조합한다.
                if(data.addressType === 'R'){
                    //법정동명이 있을 경우 추가한다.
                    if(data.bname !== ''){
                        extraAddr += data.bname;
                    }
                    // 건물명이 있을 경우 추가한다.
                    if(data.buildingName !== ''){
                        extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
                    }
                    // 조합형주소의 유무에 따라 양쪽에 괄호를 추가하여 최종 주소를 만든다.
                    fullAddr += (extraAddr !== '' ? ' ('+ extraAddr +')' : '');
                }

                // 우편번호와 주소 정보를 해당 필드에 넣는다.
                document.getElementById('rzipcode1').value = data.zonecode; //5자리 새우편번호 사용
                document.getElementById('raddr1').value = fullRoadAddr;
                document.getElementById('raddr2').value = data.jibunAddress;

                // iframe을 넣은 element를 안보이게 한다.
                // (autoClose:false 기능을 이용한다면, 아래 코드를 제거해야 화면에서 사라지지 않는다.)
                element_layer.style.display = 'none';
            },
            width : '100%',
            height : '100%',
            maxSuggestItems : 5
        }).embed(element_layer);

        // iframe을 넣은 element를 보이게 한다.
        element_layer.style.display = 'block';

        // iframe을 넣은 element의 위치를 화면의 가운데로 이동시킨다.
        initLayerPosition();
    }

    // 브라우저의 크기 변경에 따라 레이어를 가운데로 이동시키고자 하실때에는
    // resize이벤트나, orientationchange이벤트를 이용하여 값이 변경될때마다 아래 함수를 실행 시켜 주시거나,
    // 직접 element_layer의 top,left값을 수정해 주시면 됩니다.
    function initLayerPosition(){
        var width = 320; //우편번호서비스가 들어갈 element의 width
        var height = 400; //우편번호서비스가 들어갈 element의 height
        var borderWidth = 2; //샘플에서 사용하는 border의 두께

        // 위에서 선언한 값들을 실제 element에 넣는다.
        element_layer.style.width = width + 'px';
        element_layer.style.height = height + 'px';
        element_layer.style.border = borderWidth + 'px solid';
        // 실행되는 순간의 화면 너비와 높이 값을 가져와서 중앙에 뜰 수 있도록 위치를 계산한다.
        element_layer.style.left = (((window.innerWidth || document.documentElement.clientWidth) - width)/2 - borderWidth) + 'px';
        element_layer.style.top = (((window.innerHeight || document.documentElement.clientHeight) - height)/2 - borderWidth) + 'px';
    }
</script>
<script>
$(document).ready(function(){
    $('.payArea .method label').click(function(){
        $('.payArea .method label').css({'color':'rgba(0,0,0,.8)','background-color':'#fff'});
        $(this).css({'color':'#fff','background-color':'#d6254a'});
    });
});
</script>

<div class="container" module="Order_form" unroll=1>
    <div class="p40"></div>
    <h1 class="titleH1">ORDER / PAYMENT</h1>
    <div class="p40"></div><div class="p10"></div>
    <!-- 이값은 지우면 안되는 값입니다. ($move_order_after 주문완료페이지 주소 / $move_basket 장바구니페이지 주소)
        $move_order_after=/order/order_result.html
        $move_basket=/order/basket.html
    -->
    <!-- 국내배송상품 주문내역 -->

    <div class="col-md-7 p0">
        <h3 class="subTitle">주문자 정보</h3>
        <div class="p20"></div>
        <div class="orderArea">
            <div class="tableWrap">
                <table border="1" summary="">
                <!-- 국문 쇼핑몰 -->
                <tbody class="{$address_form} {$address_korean_display|display}">
                    <tr>
                        <th scope="row">주문하시는 분</th>
                        <td>{$form.oname}</td>
                    </tr>
                    <tr>
                        <th scope="row">휴대전화</th>
                        <td>{$form.ophone2_}</td>
                    </tr>
                    <tr>
                        <th scope="row">이메일</th>
                        <td>{$form.oemail}</td>
                    </tr>
                </tbody>
                </table>
            </div>
        </div>
        
        <div class="p40"></div><div class="p10"></div>
        
        <h3 class="subTitle">배송지 정보</h3>
        <div class="p20"></div>
        <div class="orderArea {$r_info_display|display}">
            <div class="tableWrap">
                <table border="1" summary="">
                <tbody>
                    <tr>
                        <th scope="row">배송지 선택</th>
                        <td>
                            <div class="address">
                                {$form.sameaddr}
                                <label style="position: relative;"><a href="#none" id="{$btn_shipp_addr_id}" class="{$btn_address_display|display}">주소록 보기</a></label>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th scope="row">받으시는 분</th>
                        <td>{$form.rname}</td>
                    </tr>
                    <tr>
                        <th scope="row">주소</th>
                        <td>
                            {$form.rzipcode1}{$form.rzipcode2}
                            <label class="addrLabel"><a href="#" onclick="sample4_execDaumPostcode()">우편번호</a></label><br />
                            {$form.raddr1}<br />
                            {$form.raddr2}
                        </td>
                    </tr>
                    <tr>
                        <th scope="row">휴대전화</th>
                        <td>{$form.rphone2_}</td>
                    </tr>
                    <tr class="{$use_delivery_message_display}">
                        <th scope="row">배송메시지</th>
                        <td>{$form.omessage}</td>
                    </tr>
                </tbody>
                </table>
            </div>
        </div>
        
        <div class="p40"></div><div class="p10"></div>
        
        <h3 class="subTitle">결제수단</h3>
        <div class="p20"></div>
        <div class="payArea tableWrap">
            <div class="payment">
                <div class="method">{$form.addr_paymethod}</div>
                <div class="p10 mp0"></div>
                <div class="info">
                    <!-- 무통장입금 -->
                    <table border="1" summary="" id="{$payment_input_cash}" style="display:none;">
                    <caption>무통장입금</caption>
                    <tbody>
                        <tr>
                            <th scope="row">입금자명</th>
                            <td>{$form.pname}</td>
                        </tr>
                        <tr>
                            <th scope="row">입금은행</th>
                            <td>
                                {$form.bankaccount}
                            </td>
                        </tr>
                    </tbody>
                    </table>
                    <!-- 실시간 계좌이체 -->
                    <table border="1" summary="" id="{$payment_input_tcash}" style="display:none;">
                    <caption>실시간 계좌이체</caption>
                    <tbody>
                        <tr>
                            <th scope="row">입금자명</th>
                            <td>{$form.allat_account_nm}</td>
                        </tr>
                    </tbody>
                    </table>
                    <!-- 에스크로(가상계좌) -->
                    <table border="1" summary="" id="{$payment_input_icash}" style="display:none;">
                    <caption>에스크로(가상계좌)</caption>
                    <tbody>
                        <tr>
                            <th scope="row">에스크로</th>
                            <td>{$form.flagEscrowIcashUse}<label for="flagEscrowIcashUse0">에스크로(구매안전)서비스를 적용합니다.</label></td>
                        </tr>
                    </tbody>
                    </table>
                    <!-- 무통장입금, 카드결제, 휴대폰결제, 실시간계좌이체 -->
                    <div id="{$pg_paymethod_info}" class="payHelp">
                        <p id="{$pg_paymethod_info_pg}">소액 결제의 경우 PG사 정책에 따라 결제 금액 제한이 있을 수 있습니다.</p>
                        <p id="{$pg_paymethod_info_shipfee}">최소 결제 가능 금액은 결제금액에서 배송비를 제외한 금액입니다.</p>
                        
                    </div>
                    
                    <!-- 케이페이 도움말 -->
                    <div id="{$kpay_info}" class="payHelp">
                        <p>휴대폰에 설치된 케이페이 앱에서 비밀번호 입력만으로 빠르고 안전하게 결제가 가능한 서비스 입니다.</p>
                        <p>안드로이드의 경우 구글 플레이, 아이폰의 경우 앱 스토어에서 케이페이 앱을 설치 한 후,<br/>
                    최초 1회 카드정보를 등록하셔야 사용 가능합니다.</p>
                    </div>
                    <!-- 페이나우 도움말 -->
                    <div id="{$paynow_info}" class="payHelp">
                        <p>휴대폰에 설치된 페이나우 앱에서 비밀번호 입력만으로 빠르고 안전하게 결제가 가능한 서비스 입니다.</p>
                        <p>안드로이드의 경우 구글 플레이, 아이폰의 경우 앱 스토어에서 페이나우 앱을 설치 한 후,<br/>
                    최초 1회 카드 및 계좌 정보를 등록하셔야 사용 가능합니다</p>
                    </div>
                    <!-- 페이코 도움말 -->
                    <div id="{$payco_info}" class="payHelp">
                        <p>페이코 결제 팝업창에서 비밀번호 입력만으로 빠르고 안전하게 결제가 가능한 서비스 입니다.</p>
                        <p><a href="http://www.payco.com" target="_blank">www.payco.com</a> 에 회원가입 후, 최초 1회 카드 및 계좌 정보를 등록하셔야 사용 가능합니다.</p>
                    </div>
                </div>
                <div class="agree">
                    <table border="1" summary="">
                    <caption>결제관련동의</caption>
                    <!-- 현금영수증 발행 -->
                    <tbody id="{$cashreceipt_display_area}" class="cashReceipt {$cashreceipt_display|display}">
                        <tr>
                            <th scope="row">현금영수증<br />발행</th>
                            <td>
                                {$form.cashreceipt_user_type}
                                <div class="mobile" id="{$cashreceipt_mobile_display_area}">
                                    <strong>휴대전화 : </strong>
                                    {$form.cashreceipt_user_mobile}
                                </div>
                                <div class="regno" id="{$cashreceipt_regno_display_area}">
                                    <strong>사업자등록번호 : </strong>
                                    {$form.cashreceipt_reg_no}
                                    <p class="grid">입력 시 '-' 없이 숫자만 입력하세요.</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                    <!-- 청약철회방침 -->
                    <tbody class="{$subscription_display|display}">
                        <tr>
                            <th scope="row">청약철회방침</th>
                            <td>
                                <div class="textArea">
                                    {$form.subscription_terms}
                                    <a href="#none" onclick="{$subscription_script}"><img src="http://img.echosting.cafe24.com/skin/base_ko_KR/order/btn_more.gif" alt="전체보기" /></a>
                                </div>
                                <p>{$form.subscription_agreement_chk}<label for="subscription_agreement_chk0"><strong>동의함</strong></label></p>
                            </td>
                        </tr>
                    </tbody>
                    <!-- 전자보증보험-->
                    <tbody class="guarantee {$eguarantee_display|display}">
                        <tr>
                            <th scope="row">전자보증보험</th>
                            <td>
                                <div>
                                    <p>전자보증보험 발급 여부 : {$form.eguarantee_flag}</p>
                                    <p>전자보증보험 안내(100% 매매보호 안전결제) <a href="/common/usafe_notice.php" target="_blank" onclick="window.open(this.href,'new','height=500 width=550 toolbar=no location=no directory=no status=no resizable=no'); return false;">[자세히보기]</a></p>
                                    <p>물품대금결제시 구매자의 피해보호를 위해 '(주)서울보증보험'의 보증보험증권이 발급됩니다.</p>
                                    <p>증권이 발급되는 것의 의미는, 물품대금 결제시에 소비자에게 서울보증보험의 쇼핑몰보증보험 계약체결서를 인터넷상으로 자동 발급하여, 피해발생시 쇼핑몰보증보험으로써 완벽하게 보호받을 수 있습니다.</p>
                                    <p>또한, 입력하신 개인정보는 증권발급을 위해 필요한 정보이며 다른 용도로 사용되지 않습니다. </p>
                                    <p>전자보증보험 발생시 별도의 수수료가 부과되지 않습니다.</p>
                                </div>
                                <div id="{$eguarantee_personal_id}">
                                    <p>생년월일 : {$form.eguarantee_year} 년 {$form.eguarantee_month} 월 {$form.eguarantee_day} 일</p>
                                    <p>성별 : {$form.eguarantee_user_gender}</p>
                                    <p>개인정보 이용동의 : {$form.eguarantee_personal_agreement}</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-1"></div>
    
    <div class="col-md-4 p0">
        <div class="mp30"></div>
        <h3 class="subTitle">기본배송 정보</h3>
        <div class="p20"></div>
        <div class="orderListArea {$default_display|display}">
            <div class="tableWrap {$normal_display|display}">
                <table border="1" summary="">
                    <tfoot>
                        <tr>
                            <td><div class="p10"></div>총 상품금액</td>
                            <td></td>
                            <td><div class="p10"></div>￦ {$normal_total_product_price}</td>
                        </tr>
                        <tr>
                            <td>배송비</td>
                            <td></td>
                            <td>￦ <span id="{$domestic_ship_fee}">{$normal_total_delv_price}{$price_unit_tail}</span></td>
                        </tr>
                        <tr>
                            <td>최종금액</td>
                            <td></td>
                            <td class="highlight">￦ <span id="{$domestic_ship_fee_sum}">{$normal_total_price}{$price_unit_tail}</span></td>
                        </tr>
                    </tfoot>
                    <tbody module="Order_normallist">
                        <tr>
                            <td class="thumb"><img src="{$product_image}" onerror="this.src='http://img.echosting.cafe24.com/thumb/img_product_small.gif';"/></td>
                            <td class="product"><strong>{$product_name}</strong><div class="option {$option_display|display}">{$option_str}</div></td>
                            <td class="quantity">{$product_quantity_text} EA</td>
                        </tr>
                        <tr>
                            <td class="thumb"><img src="{$product_image}" onerror="this.src='http://img.echosting.cafe24.com/thumb/img_product_small.gif';"/></td>
                            <td class="product"><strong>{$product_name}</strong><div class="option {$option_display|display}">{$option_str}</div></td>
                            <td class="quantity">{$product_quantity_text} EA</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="p10"></div>
        
        
        <!-- 최종결제금액 -->
        <div class="total">
            <div class="displaynone">
                <h4><strong id="{$current_pay_name}">{$current_pay_name_default}</strong> <span>최종결제 금액</span></h4>
                <p class="price"><span>{$price_unit_head}</span>{$form.total_price}<span>{$price_unit_tail}</span></p>
            </div>
            <p class="paymentAgree" id="{$chk_purchase_agreement}">{$form.chk_purchase_agreement}</p>
            <div class="btnArea">
                <div class="p10"></div>
                <a class="btnNormal btn4" onClick="history.go(-1)">돌아가기</a>
                <div class="p10"></div>
                <a id="{$btn_payment_id}" class="btnBasic btn4" href="#none">결제하기</a>
            </div>
        </div>
    </div>
    
    <!-- 안심번호 팝업 레이어 -->
    <div id="{$safe_phone_popup_layer}"></div>
    <!-- 결제진행바 -->
    <iframe id="{$payment_proc_id}" name="h_payment" width="0" height="0" frameborder="0" src=""></iframe>
    <!-- //결제진행바 -->
</div>

<div class="p80"></div><div class="p40"></div><div class="p10"></div>
